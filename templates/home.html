{% extends 'base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}
{% block meta_description %}{{ meta_description }}{% endblock %}

{% block content %}
    <!-- Hero Section Begin -->
    <section class="hero spad set-bg" style="background-image: url('{% static "img/hero-bg.jpg" %}');">
        <div class="container">
            <div class="row">
                <div class="col-lg-7">
                    <div class="hero__text text-white">
                        <div class="hero__text__title">
                            <span class="text-warning">FIND YOUR DREAM CAR</span>
                            {% if featured_cars %}
                                <h2 class="display-4 fw-bold">{{ featured_cars.0.brand.name }} {{ featured_cars.0.car_model.name }}</h2>
                            {% else %}
                                <h2 class="display-4 fw-bold">Your Next Car Awaits</h2>
                            {% endif %}
                        </div>
                        {% if featured_cars %}
                        <div class="hero__text__price">
                            <div class="car-model mb-2">Model {{ featured_cars.0.year }}</div>
                            {% if featured_cars.0.is_for_rent %}
                                <h2 class="text-warning">KSh {{ featured_cars.0.monthly_rent_estimate|floatformat:0|default:"Contact" }}<span class="fs-6">/Month</span></h2>
                            {% else %}
                                <h2 class="text-warning">KSh {{ featured_cars.0.final_price|floatformat:0 }}</h2>
                            {% endif %}
                        </div>
                        {% endif %}
                        <div class="mt-4">
                            <a href="#" class="btn btn-warning btn-lg me-3">
                                <i class="fa fa-car me-2"></i>Test Drive
                            </a>
                            <a href="{% url 'cars:car_list' %}" class="btn btn-outline-light btn-lg">Learn More</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="hero__tab bg-white rounded p-4">
                        <ul class="nav nav-pills mb-4" role="tablist">
                            <li class="nav-item w-50">
                                <a class="nav-link active text-center" data-bs-toggle="pill" href="#rental-tab" role="tab">Car Rental</a>
                            </li>
                            <li class="nav-item w-50">
                                <a class="nav-link text-center" data-bs-toggle="pill" href="#purchase-tab" role="tab">Buy Car</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="rental-tab" role="tabpanel">
                                <div class="hero__tab__form">
                                    <h4 class="mb-4">Find Your Rental Car</h4>
                                    <form action="{% url 'cars:car_list' %}" method="get">
                                        <input type="hidden" name="availability" value="rent">
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <label class="form-label">Select Year</label>
                                                <select name="year" class="form-select">
                                                    <option value="">Select Year</option>
                                                    {% for year in year_range.min_year|add:0 %}
                                                        {% if year <= year_range.max_year %}
                                                        <option value="{{ year }}">{{ year }}</option>
                                                        {% endif %}
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Select Brand</label>
                                                <select name="brand" class="form-select">
                                                    <option value="">Select Brand</option>
                                                    {% for brand in brands %}
                                                    <option value="{{ brand.id }}">{{ brand.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Select Model</label>
                                                <select name="model" class="form-select">
                                                    <option value="">Select Model</option>
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Budget Range</label>
                                                <input type="text" id="rental-amount" class="form-control" readonly>
                                                <div class="price-range mt-2"></div>
                                            </div>
                                            <div class="col-12">
                                                <button type="submit" class="btn btn-primary w-100">Search Rentals</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="purchase-tab" role="tabpanel">
                                <div class="hero__tab__form">
                                    <h4 class="mb-4">Buy Your Dream Car</h4>
                                    <form action="{% url 'cars:car_list' %}" method="get">
                                        <input type="hidden" name="availability" value="sale">
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <label class="form-label">Select Year</label>
                                                <select name="year" class="form-select">
                                                    <option value="">Select Year</option>
                                                    {% for year in year_range.min_year|add:0 %}
                                                        {% if year <= year_range.max_year %}
                                                        <option value="{{ year }}">{{ year }}</option>
                                                        {% endif %}
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Select Brand</label>
                                                <select name="brand" class="form-select">
                                                    <option value="">Select Brand</option>
                                                    {% for brand in brands %}
                                                    <option value="{{ brand.id }}">{{ brand.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Select Model</label>
                                                <select name="model" class="form-select">
                                                    <option value="">Select Model</option>
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Price Range</label>
                                                <input type="text" id="purchase-amount" class="form-control" readonly>
                                                <div class="price-range mt-2"></div>
                                            </div>
                                            <div class="col-12">
                                                <button type="submit" class="btn btn-primary w-100">Search Cars</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Hero Section End -->

    <!-- Services Section Begin -->
    <section class="services spad bg-light">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title">
                        <span>Our Services</span>
                        <h2>What We Offer</h2>
                        <p>Comprehensive automotive solutions for all your car needs in Kenya</p>
                    </div>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-lg-3 col-md-6">
                    <div class="services__item text-center p-4 bg-white rounded shadow-sm h-100">
                        <div class="services__icon mb-3">
                            <i class="fas fa-car fa-3x text-primary"></i>
                        </div>
                        <h5 class="mb-3">Car Rental</h5>
                        <p class="text-muted">Daily, weekly, and monthly car rental services with competitive rates and quality vehicles.</p>
                        <a href="{% url 'cars:car_list' %}?availability=rent" class="btn btn-outline-primary">
                            <i class="fa fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="services__item text-center p-4 bg-white rounded shadow-sm h-100">
                        <div class="services__icon mb-3">
                            <i class="fas fa-shopping-cart fa-3x text-primary"></i>
                        </div>
                        <h5 class="mb-3">Car Sales</h5>
                        <p class="text-muted">Wide selection of new and used cars from trusted brands with financing options available.</p>
                        <a href="{% url 'cars:car_list' %}?availability=sale" class="btn btn-outline-primary">
                            <i class="fa fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="services__item text-center p-4 bg-white rounded shadow-sm h-100">
                        <div class="services__icon mb-3">
                            <i class="fas fa-tools fa-3x text-primary"></i>
                        </div>
                        <h5 class="mb-3">Car Maintenance</h5>
                        <p class="text-muted">Professional maintenance and repair services to keep your vehicle in excellent condition.</p>
                        <a href="{% url 'cars:contact' %}" class="btn btn-outline-primary">
                            <i class="fa fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="services__item text-center p-4 bg-white rounded shadow-sm h-100">
                        <div class="services__icon mb-3">
                            <i class="fas fa-headset fa-3x text-primary"></i>
                        </div>
                        <h5 class="mb-3">24/7 Support</h5>
                        <p class="text-muted">Round-the-clock customer support for all your automotive needs and emergencies.</p>
                        <a href="{% url 'cars:contact' %}" class="btn btn-outline-primary">
                            <i class="fa fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Services Section End -->

    <!-- Feature Section Begin -->
    <section class="feature spad">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="feature__text">
                        <div class="section-title text-start">
                            <span>Our Features</span>
                            <h2>We Are a Trusted Name in Automotive</h2>
                        </div>
                        <div class="feature__text__desc">
                            <p>Kai and Karo has been serving Kenya's automotive needs with integrity, quality, and exceptional service. We specialize in connecting you with the perfect vehicle.</p>
                            <p>Whether you're looking for a reliable family car, a luxury vehicle, or need short-term rental solutions, we have the expertise and inventory to meet your needs.</p>
                        </div>
                        <div class="feature__text__btn">
                            <a href="{% url 'cars:about' %}" class="btn btn-primary me-3">About Us</a>
                            <a href="{% url 'cars:contact' %}" class="btn btn-outline-primary">Contact Us</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-cog fa-2x text-primary"></i>
                                </div>
                                <h6>Engine Quality</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-tachometer-alt fa-2x text-primary"></i>
                                </div>
                                <h6>Performance</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-snowflake fa-2x text-primary"></i>
                                </div>
                                <h6>Cooling System</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-car-crash fa-2x text-primary"></i>
                                </div>
                                <h6>Safety Features</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-battery-full fa-2x text-primary"></i>
                                </div>
                                <h6>Electrical</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-car-brake fa-2x text-primary"></i>
                                </div>
                                <h6>Brake System</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Feature Section End -->

    <!-- Car Section Begin -->
    <section class="car spad bg-light">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title">
                        <span>Our Cars</span>
                        <h2>Best Vehicle Offers</h2>
                    </div>
                    <ul class="nav nav-pills justify-content-center mb-5">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="pill" href="#featured-cars">Featured Cars</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="pill" href="#latest-cars">Latest Arrivals</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="featured-cars">
                    <div class="row">
                        {% for car in featured_cars %}
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="car__item">
                                <div class="car__item__pic">
                                    {% if car.main_image %}
                                    <img src="{{ car.main_image.image.url }}" alt="{{ car.title }}" class="img-fluid">
                                    {% else %}
                                    <img src="{% static 'img/cars/default-car.jpg' %}" alt="{{ car.title }}" class="img-fluid">
                                    {% endif %}
                                </div>
                                <div class="car__item__text p-3">
                                    <div class="car__item__text__inner">
                                        <div class="label-date badge bg-secondary mb-2">{{ car.year }}</div>
                                        <h5><a href="{{ car.get_absolute_url }}" class="text-decoration-none">{{ car.brand.name }} {{ car.car_model.name }}</a></h5>
                                        <ul class="list-inline text-muted small mb-3">
                                            <li class="list-inline-item"><span>{{ car.mileage|floatformat:0 }}</span> km</li>
                                            <li class="list-inline-item">{{ car.get_transmission_display }}</li>
                                            <li class="list-inline-item"><span>{{ car.horsepower }}</span> hp</li>
                                        </ul>
                                    </div>
                                    <div class="car__item__price d-flex justify-content-between align-items-center">
                                        {% if car.is_for_rent %}
                                        <span class="badge bg-success">For Rent</span>
                                        <h6 class="text-primary mb-0">KSh {{ car.monthly_rent_estimate|floatformat:0 }}<span class="small">/Month</span></h6>
                                        {% else %}
                                        <span class="badge bg-primary">For Sale</span>
                                        <h6 class="text-primary mb-0">KSh {{ car.final_price|floatformat:0 }}</h6>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center">
                            <p class="text-muted">No featured cars available at the moment.</p>
                            <a href="{% url 'cars:car_list' %}" class="btn btn-primary">Browse All Cars</a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="tab-pane fade" id="latest-cars">
                    <div class="row">
                        {% for car in latest_cars %}
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="car__item">
                                <div class="car__item__pic">
                                    {% if car.main_image %}
                                    <img src="{{ car.main_image.image.url }}" alt="{{ car.title }}" class="img-fluid">
                                    {% else %}
                                    <img src="{% static 'img/cars/default-car.jpg' %}" alt="{{ car.title }}" class="img-fluid">
                                    {% endif %}
                                </div>
                                <div class="car__item__text p-3">
                                    <div class="car__item__text__inner">
                                        <div class="label-date badge bg-secondary mb-2">{{ car.year }}</div>
                                        <h5><a href="{{ car.get_absolute_url }}" class="text-decoration-none">{{ car.brand.name }} {{ car.car_model.name }}</a></h5>
                                        <ul class="list-inline text-muted small mb-3">
                                            <li class="list-inline-item"><span>{{ car.mileage|floatformat:0 }}</span> km</li>
                                            <li class="list-inline-item">{{ car.get_transmission_display }}</li>
                                            <li class="list-inline-item"><span>{{ car.horsepower }}</span> hp</li>
                                        </ul>
                                    </div>
                                    <div class="car__item__price d-flex justify-content-between align-items-center">
                                        {% if car.is_for_rent %}
                                        <span class="badge bg-success">For Rent</span>
                                        <h6 class="text-primary mb-0">KSh {{ car.monthly_rent_estimate|floatformat:0 }}<span class="small">/Month</span></h6>
                                        {% else %}
                                        <span class="badge bg-primary">For Sale</span>
                                        <h6 class="text-primary