{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}
{% block title %}{{ page_title }}{% endblock %}
{% block meta_description %}{{ meta_description }}{% endblock %}

{% block content %}
    <!-- Hero Section Begin -->
    <section class="hero spad set-bg" style="background-image: url('{% static "img/hero-bg.jpg" %}');">
        <div class="container">
            <div class="row">
                <div class="col-lg-7">
                    <div class="hero__text text-white">
                        <div class="hero__text__title">
                            <span class="text-warning">FIND YOUR DREAM CAR</span>
                            {% if featured_cars %}
                                <h2 class="display-4 fw-bold">{{ featured_cars.0.brand.name }} {{ featured_cars.0.car_model.name }}</h2>
                            {% else %}
                                <h2 class="display-4 fw-bold">Your Next Car Awaits</h2>
                            {% endif %}
                        </div>
                        {% if featured_cars %}
                        <div class="hero__text__price">
                            <div class="car-model mb-2">Model {{ featured_cars.0.year }}</div>
                            {% if featured_cars.0.is_for_rent %}
                                <h2 class="text-warning">KSh {{ featured_cars.0.monthly_rent_estimate|floatformat:0|default:"Contact" }}<span class="fs-6">/Month</span></h2>
                            {% else %}
                                <h2 class="text-warning">KSh {{ featured_cars.0.final_price|floatformat:0 }}</h2>
                            {% endif %}
                        </div>
                        {% endif %}
                        <div class="mt-4">
                            <a href="#" class="btn btn-warning btn-lg me-3">
                                <i class="fa fa-car me-2"></i>Test Drive
                            </a>
                            <a href="{% url 'car_list' %}" class="btn btn-outline-light btn-lg">Learn More</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-5">
                    <div class="hero__tab bg-white rounded p-4">
                        <ul class="nav nav-pills mb-4" role="tablist">
                            <li class="nav-item w-50">
                                <a class="nav-link active text-center" data-bs-toggle="pill" href="#rental-tab" role="tab">Car Rental</a>
                            </li>
                            <li class="nav-item w-50">
                                <a class="nav-link text-center" data-bs-toggle="pill" href="#purchase-tab" role="tab">Buy Car</a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="rental-tab" role="tabpanel">
                                <div class="hero__tab__form">
                                    <h4 class="mb-4">Find Your Rental Car</h4>
                                    <form action="{% url 'car_list' %}" method="get">
                                        <input type="hidden" name="availability" value="rent">
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <label class="form-label">Select Year</label>
                                                <select name="year" class="form-select">
                                                    <option value="">Select Year</option>
                                                    {% for year in "2015,2016,2017,2018,2019,2020,2021,2022,2023,2024"|split:"," %}
                                                        <option value="{{ year }}">{{ year }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Select Brand</label>
                                                <select name="brand" class="form-select" id="rental-brand-select">
                                                    <option value="">Select Brand</option>
                                                    {% for brand in brands %}
                                                    <option value="{{ brand.id }}">{{ brand.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Select Model</label>
                                                <select name="model" class="form-select" id="rental-model-select">
                                                    <option value="">Select Model</option>
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Budget Range (KSh/Month)</label>
                                                <input type="text" name="price_range" id="rental-amount" class="form-control" placeholder="10,000 - 50,000" readonly>
                                                <div class="price-range mt-2">
                                                    <input type="range" class="form-range" min="5000" max="100000" value="25000" step="5000" id="rental-price-slider">
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <button type="submit" class="btn btn-primary w-100">Search Rentals</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="purchase-tab" role="tabpanel">
                                <div class="hero__tab__form">
                                    <h4 class="mb-4">Buy Your Dream Car</h4>
                                    <form action="{% url 'car_list' %}" method="get">
                                        <input type="hidden" name="availability" value="sale">
                                        <div class="row g-3">
                                            <div class="col-12">
                                                <label class="form-label">Select Year</label>
                                                <select name="year" class="form-select">
                                                    <option value="">Select Year</option>
                                                    {% for year in "2015,2016,2017,2018,2019,2020,2021,2022,2023,2024"|split:"," %}
                                                        <option value="{{ year }}">{{ year }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Select Brand</label>
                                                <select name="brand" class="form-select" id="purchase-brand-select">
                                                    <option value="">Select Brand</option>
                                                    {% for brand in brands %}
                                                    <option value="{{ brand.id }}">{{ brand.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Select Model</label>
                                                <select name="model" class="form-select" id="purchase-model-select">
                                                    <option value="">Select Model</option>
                                                </select>
                                            </div>
                                            <div class="col-12">
                                                <label class="form-label">Price Range (KSh)</label>
                                                <input type="text" name="price_range" id="purchase-amount" class="form-control" placeholder="500,000 - 5,000,000" readonly>
                                                <div class="price-range mt-2">
                                                    <input type="range" class="form-range" min="200000" max="10000000" value="2500000" step="100000" id="purchase-price-slider">
                                                </div>
                                            </div>
                                            <div class="col-12">
                                                <button type="submit" class="btn btn-primary w-100">Search Cars</button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Hero Section End -->

    <!-- Services Section Begin -->
    <section class="services spad bg-light">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title text-center">
                        <span class="text-primary">Our Services</span>
                        <h2>What We Offer</h2>
                        <p>Comprehensive automotive solutions for all your car needs in Kenya</p>
                    </div>
                </div>
            </div>
            <div class="row g-4">
                <div class="col-lg-3 col-md-6">
                    <div class="services__item text-center p-4 bg-white rounded shadow-sm h-100">
                        <div class="services__icon mb-3">
                            <i class="fas fa-car fa-3x text-primary"></i>
                        </div>
                        <h5 class="mb-3">Car Rental</h5>
                        <p class="text-muted">Daily, weekly, and monthly car rental services with competitive rates and quality vehicles.</p>
                        <a href="{% url 'car_list' %}?availability=rent" class="btn btn-outline-primary">
                            <i class="fa fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="services__item text-center p-4 bg-white rounded shadow-sm h-100">
                        <div class="services__icon mb-3">
                            <i class="fas fa-shopping-cart fa-3x text-primary"></i>
                        </div>
                        <h5 class="mb-3">Car Sales</h5>
                        <p class="text-muted">Wide selection of new and used cars from trusted brands with financing options available.</p>
                        <a href="{% url 'car_list' %}?availability=sale" class="btn btn-outline-primary">
                            <i class="fa fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="services__item text-center p-4 bg-white rounded shadow-sm h-100">
                        <div class="services__icon mb-3">
                            <i class="fas fa-tools fa-3x text-primary"></i>
                        </div>
                        <h5 class="mb-3">Car Maintenance</h5>
                        <p class="text-muted">Professional maintenance and repair services to keep your vehicle in excellent condition.</p>
                        <a href="{% url 'contact' %}" class="btn btn-outline-primary">
                            <i class="fa fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="services__item text-center p-4 bg-white rounded shadow-sm h-100">
                        <div class="services__icon mb-3">
                            <i class="fas fa-headset fa-3x text-primary"></i>
                        </div>
                        <h5 class="mb-3">24/7 Support</h5>
                        <p class="text-muted">Round-the-clock customer support for all your automotive needs and emergencies.</p>
                        <a href="{% url 'contact' %}" class="btn btn-outline-primary">
                            <i class="fa fa-arrow-right"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Services Section End -->

    <!-- Feature Section Begin -->
    <section class="feature spad">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="feature__text">
                        <div class="section-title text-start">
                            <span class="text-primary">Our Features</span>
                            <h2>We Are a Trusted Name in Automotive</h2>
                        </div>
                        <div class="feature__text__desc">
                            <p>Kai and Karo has been serving Kenya's automotive needs with integrity, quality, and exceptional service. We specialize in connecting you with the perfect vehicle.</p>
                            <p>Whether you're looking for a reliable family car, a luxury vehicle, or need short-term rental solutions, we have the expertise and inventory to meet your needs.</p>
                        </div>
                        <div class="feature__text__btn">
                            <a href="{% url 'about' %}" class="btn btn-primary me-3">About Us</a>
                            <a href="{% url 'contact' %}" class="btn btn-outline-primary">Contact Us</a>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="row g-3">
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-cog fa-2x text-primary"></i>
                                </div>
                                <h6>Engine Quality</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-tachometer-alt fa-2x text-primary"></i>
                                </div>
                                <h6>Performance</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-snowflake fa-2x text-primary"></i>
                                </div>
                                <h6>Cooling System</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-car-crash fa-2x text-primary"></i>
                                </div>
                                <h6>Safety Features</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-battery-full fa-2x text-primary"></i>
                                </div>
                                <h6>Electrical</h6>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="feature__item text-center p-3 bg-light rounded">
                                <div class="feature__item__icon mb-2">
                                    <i class="fas fa-car-brake fa-2x text-primary"></i>
                                </div>
                                <h6>Brake System</h6>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Feature Section End -->

    <!-- Car Section Begin -->
    <section class="car spad bg-light">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title text-center">
                        <span class="text-primary">Our Cars</span>
                        <h2>Best Vehicle Offers</h2>
                    </div>
                    <ul class="nav nav-pills justify-content-center mb-5">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="pill" href="#featured-cars">Featured Cars</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="pill" href="#latest-cars">Latest Arrivals</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="tab-content">
                <div class="tab-pane fade show active" id="featured-cars">
                    <div class="row">
                        {% for car in featured_cars %}
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="car__item bg-white rounded shadow-sm">
                                <div class="car__item__pic position-relative">
                                    {% if car.main_image %}
                                    <img src="{{ car.main_image.image.url }}" alt="{{ car.title }}" class="img-fluid rounded-top" style="height: 200px; object-fit: cover; width: 100%;">
                                    {% else %}
                                    <img src="{% static 'img/cars/default-car.jpg' %}" alt="{{ car.title }}" class="img-fluid rounded-top" style="height: 200px; object-fit: cover; width: 100%;">
                                    {% endif %}
                                    <div class="position-absolute top-0 start-0 m-2">
                                        <span class="badge bg-primary">{{ car.get_car_type_display }}</span>
                                    </div>
                                </div>
                                <div class="car__item__text p-3">
                                    <div class="car__item__text__inner">
                                        <div class="label-date badge bg-secondary mb-2">{{ car.year }}</div>
                                        <h5><a href="{{ car.get_absolute_url }}" class="text-decoration-none text-dark">{{ car.brand.name }} {{ car.car_model.name }}</a></h5>
                                        <ul class="list-inline text-muted small mb-3">
                                            <li class="list-inline-item"><i class="fas fa-road"></i> {{ car.mileage|floatformat:0 }} km</li>
                                            <li class="list-inline-item"><i class="fas fa-cogs"></i> {{ car.get_transmission_display }}</li>
                                            <li class="list-inline-item"><i class="fas fa-tachometer-alt"></i> {{ car.horsepower }} hp</li>
                                        </ul>
                                    </div>
                                    <div class="car__item__price d-flex justify-content-between align-items-center">
                                        {% if car.is_for_rent %}
                                        <span class="badge bg-success">For Rent</span>
                                        <h6 class="text-primary mb-0">KSh {{ car.monthly_rent_estimate|floatformat:0|default:"Contact" }}<span class="small">/Month</span></h6>
                                        {% else %}
                                        <span class="badge bg-warning">For Sale</span>
                                        <h6 class="text-primary mb-0">KSh {{ car.final_price|floatformat:0 }}</h6>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center">
                            <p class="text-muted">No featured cars available at the moment.</p>
                            <a href="{% url 'car_list' %}" class="btn btn-primary">Browse All Cars</a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="tab-pane fade" id="latest-cars">
                    <div class="row">
                        {% for car in latest_cars %}
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="car__item bg-white rounded shadow-sm">
                                <div class="car__item__pic position-relative">
                                    {% if car.main_image %}
                                    <img src="{{ car.main_image.image.url }}" alt="{{ car.title }}" class="img-fluid rounded-top" style="height: 200px; object-fit: cover; width: 100%;">
                                    {% else %}
                                    <img src="{% static 'img/cars/default-car.jpg' %}" alt="{{ car.title }}" class="img-fluid rounded-top" style="height: 200px; object-fit: cover; width: 100%;">
                                    {% endif %}
                                    <div class="position-absolute top-0 start-0 m-2">
                                        <span class="badge bg-info">New</span>
                                    </div>
                                </div>
                                <div class="car__item__text p-3">
                                    <div class="car__item__text__inner">
                                        <div class="label-date badge bg-secondary mb-2">{{ car.year }}</div>
                                        <h5><a href="{{ car.get_absolute_url }}" class="text-decoration-none text-dark">{{ car.brand.name }} {{ car.car_model.name }}</a></h5>
                                        <ul class="list-inline text-muted small mb-3">
                                            <li class="list-inline-item"><i class="fas fa-road"></i> {{ car.mileage|floatformat:0 }} km</li>
                                            <li class="list-inline-item"><i class="fas fa-cogs"></i> {{ car.get_transmission_display }}</li>
                                            <li class="list-inline-item"><i class="fas fa-tachometer-alt"></i> {{ car.horsepower }} hp</li>
                                        </ul>
                                    </div>
                                    <div class="car__item__price d-flex justify-content-between align-items-center">
                                        {% if car.is_for_rent %}
                                        <span class="badge bg-success">For Rent</span>
                                        <h6 class="text-primary mb-0">KSh {{ car.monthly_rent_estimate|floatformat:0|default:"Contact" }}<span class="small">/Month</span></h6>
                                        {% else %}
                                        <span class="badge bg-warning">For Sale</span>
                                        <h6 class="text-primary mb-0">KSh {{ car.final_price|floatformat:0 }}</h6>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="col-12 text-center">
                            <p class="text-muted">No latest cars available at the moment.</p>
                            <a href="{% url 'car_list' %}" class="btn btn-primary">Browse All Cars</a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Car Section End -->

    <!-- Why Choose Us Section Begin -->
    <section class="chooseus spad">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6">
                    <div class="chooseus__text">
                        <div class="section-title text-start">
                            <h2>Why People Choose Us</h2>
                            <p>Discover what makes Kai and Karo the preferred choice for car buyers and renters across Kenya.</p>
                        </div>
                        <ul class="list-unstyled">
                            <li class="mb-3"><i class="fa fa-check-circle text-success me-3"></i> Comprehensive vehicle inspection and quality assurance</li>
                            <li class="mb-3"><i class="fa fa-check-circle text-success me-3"></i> Competitive pricing with transparent, no-hidden-fee policy</li>
                            <li class="mb-3"><i class="fa fa-check-circle text-success me-3"></i> Flexible financing options and rental terms available</li>
                            <li class="mb-3"><i class="fa fa-check-circle text-success me-3"></i> Expert customer service and after-sales support</li>
                        </ul>
                        <a href="{% url 'about' %}" class="btn btn-primary">About Us</a>
                    </div>
                </div>
                <div class="col-lg-6">
                    <div class="chooseus__video position-relative text-center">
                        <img src="{% static 'img/chooseus-video.png' %}" alt="Kai and Karo Showroom" class="img-fluid rounded">
                        <a href="#" class="play-btn position-absolute top-50 start-50 translate-middle btn btn-primary rounded-circle p-3" style="width: 70px; height: 70px; display: flex; align-items: center; justify-content: center;">
                            <i class="fa fa-play"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Why Choose Us Section End -->

    <!-- Latest Blog Section Begin -->
    {% if blog_posts %}
    <section class="latest spad bg-light">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title text-center">
                        <span class="text-primary">Our Blog</span>
                        <h2>Latest News Updates</h2>
                        <p>Stay informed with the latest automotive industry insights, car care tips, and company updates.</p>
                    </div>
                </div>
            </div>
            <div class="row">
                {% for post in blog_posts %}
                <div class="col-lg-4 col-md-6 mb-4">
                    <div class="latest__blog__item bg-white rounded shadow-sm overflow-hidden">
                        <div class="latest__blog__item__pic position-relative">
                            {% if post.featured_image %}
                            <img src="{{ post.featured_image.url }}" alt="{{ post.title }}" class="img-fluid" style="height: 200px; object-fit: cover; width: 100%;">
                            {% else %}
                            <img src="{% static 'img/latest-blog/default-blog.jpg' %}" alt="{{ post.title }}" class="img-fluid" style="height: 200px; object-fit: cover; width: 100%;">
                            {% endif %}
                            <div class="position-absolute bottom-0 start-0 end-0 bg-dark bg-opacity-75 text-white p-2">
                                <small>
                                    <i class="fas fa-user me-1"></i>By {{ post.author.get_full_name|default:post.author.username }}
                                    <span class="mx-2">|</span>
                                    <i class="fas fa-calendar me-1"></i>{{ post.published_date|date:"M d, Y" }}
                                </small>
                            </div>
                        </div>
                        <div class="latest__blog__item__text p-3">
                            <h5><a href="{{ post.get_absolute_url }}" class="text-decoration-none text-dark">{{ post.title }}</a></h5>
                            <p class="text-muted small">{{ post.excerpt|default:post.content|truncatewords:20 }}</p>
                            <a href="{{ post.get_absolute_url }}" class="btn btn-outline-primary btn-sm">
                                Read More <i class="fa fa-arrow-right"></i>
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>
    {% endif %}
    <!-- Latest Blog Section End -->

    <!-- CTA Section Begin -->
    <div class="cta">
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-md-6 mb-4">
                    <div class="cta__item position-relative rounded overflow-hidden" style="background-image: url('{% static "img/cta/cta-1.jpg" %}'); background-size: cover; background-position: center; height: 200px;">
                        <div class="position-absolute top-0 start-0 end-0 bottom-0 bg-dark bg-opacity-50 d-flex align-items-center justify-content-center text-center text-white p-4">
                            <div>
                                <h4 class="mb-3">Do You Want To Buy A Car?</h4>
                                <p class="mb-3">Browse our extensive collection of quality vehicles with competitive pricing</p>
                                <a href="{% url 'car_list' %}?availability=sale" class="btn btn-warning">Browse Cars</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6 col-md-6 mb-4">
                    <div class="cta__item position-relative rounded overflow-hidden" style="background-image: url('{% static "img/cta/cta-2.jpg" %}'); background-size: cover; background-position: center; height: 200px;">
                        <div class="position-absolute top-0 start-0 end-0 bottom-0 bg-dark bg-opacity-50 d-flex align-items-center justify-content-center text-center text-white p-4">
                            <div>
                                <h4 class="mb-3">Do You Want To Rent A Car?</h4>
                                <p class="mb-3">Flexible rental options with daily, weekly, and monthly rates available</p>
                                <a href="{% url 'car_list' %}?availability=rent" class="btn btn-success">Browse Rentals</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- CTA Section End -->

    <!-- JavaScript for Interactive Features -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Price slider functionality
            const rentalSlider = document.getElementById('rental-price-slider');
            const rentalAmount = document.getElementById('rental-amount');
            const purchaseSlider = document.getElementById('purchase-price-slider');
            const purchaseAmount = document.getElementById('purchase-amount');

            if (rentalSlider && rentalAmount) {
                rentalSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    rentalAmount.value = `KSh ${value.toLocaleString()} - KSh ${(value * 2).toLocaleString()}`;
                });
                
                // Initialize rental slider
                const initialRentalValue = parseInt(rentalSlider.value);
                rentalAmount.value = `KSh ${initialRentalValue.toLocaleString()} - KSh ${(initialRentalValue * 2).toLocaleString()}`;
            }

            if (purchaseSlider && purchaseAmount) {
                purchaseSlider.addEventListener('input', function() {
                    const value = parseInt(this.value);
                    purchaseAmount.value = `KSh ${value.toLocaleString()} - KSh ${(value * 2).toLocaleString()}`;
                });
                
                // Initialize purchase slider
                const initialPurchaseValue = parseInt(purchaseSlider.value);
                purchaseAmount.value = `KSh ${initialPurchaseValue.toLocaleString()} - KSh ${(initialPurchaseValue * 2).toLocaleString()}`;
            }

            // Brand-Model dependency for rental tab
            const rentalBrandSelect = document.getElementById('rental-brand-select');
            const rentalModelSelect = document.getElementById('rental-model-select');

            if (rentalBrandSelect && rentalModelSelect) {
                rentalBrandSelect.addEventListener('change', function() {
                    const brandId = this.value;
                    rentalModelSelect.innerHTML = '<option value="">Select Model</option>';
                    
                    if (brandId) {
                        // In a real implementation, you would fetch models via AJAX
                        // For now, we'll just show a loading message
                        rentalModelSelect.innerHTML = '<option value="">Loading models...</option>';
                        
                        // Simulate AJAX call
                        fetch(`/api/models/?brand=${brandId}`)
                            .then(response => response.json())
                            .then(data => {
                                rentalModelSelect.innerHTML = '<option value="">Select Model</option>';
                                data.forEach(model => {
                                    const option = document.createElement('option');
                                    option.value = model.id;
                                    option.textContent = model.name;
                                    rentalModelSelect.appendChild(option);
                                });
                            })
                            .catch(error => {
                                console.error('Error fetching models:', error);
                                rentalModelSelect.innerHTML = '<option value="">Error loading models</option>';
                            });
                    }
                });
            }

            // Brand-Model dependency for purchase tab
            const purchaseBrandSelect = document.getElementById('purchase-brand-select');
            const purchaseModelSelect = document.getElementById('purchase-model-select');

            if (purchaseBrandSelect && purchaseModelSelect) {
                purchaseBrandSelect.addEventListener('change', function() {
                    const brandId = this.value;
                    purchaseModelSelect.innerHTML = '<option value="">Select Model</option>';
                    
                    if (brandId) {
                        purchaseModelSelect.innerHTML = '<option value="">Loading models...</option>';
                        
                        fetch(`/api/models/?brand=${brandId}`)
                            .then(response => response.json())
                            .then(data => {
                                purchaseModelSelect.innerHTML = '<option value="">Select Model</option>';
                                data.forEach(model => {
                                    const option = document.createElement('option');
                                    option.value = model.id;
                                    option.textContent = model.name;
                                    purchaseModelSelect.appendChild(option);
                                });
                            })
                            .catch(error => {
                                console.error('Error fetching models:', error);
                                purchaseModelSelect.innerHTML = '<option value="">Error loading models</option>';
                            });
                    }
                });
            }

            // Smooth scrolling for anchor links
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Add loading animation to form submissions
            document.querySelectorAll('form').forEach(form => {
                form.addEventListener('submit', function() {
                    const submitBtn = form.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Searching...';
                    }
                });
            });
        });
    </script>

{% endblock %}